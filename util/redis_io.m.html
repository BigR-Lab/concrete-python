<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>concrete.util.redis_io API documentation</title>
    <meta name="description" content="" />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#concrete.util.redis_io.read_communication_from_redis_key">read_communication_from_redis_key</a></li>
    <li class="mono"><a href="#concrete.util.redis_io.write_communication_to_redis_key">write_communication_to_redis_key</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#concrete.util.redis_io.RedisCommunicationReader">RedisCommunicationReader</a></span>
        
          
  <ul>
    <li class="mono"><a href="#concrete.util.redis_io.RedisCommunicationReader.__init__">__init__</a></li>
    <li class="mono"><a href="#concrete.util.redis_io.RedisCommunicationReader.batch">batch</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#concrete.util.redis_io.RedisCommunicationWriter">RedisCommunicationWriter</a></span>
        
          
  <ul>
    <li class="mono"><a href="#concrete.util.redis_io.RedisCommunicationWriter.__init__">__init__</a></li>
    <li class="mono"><a href="#concrete.util.redis_io.RedisCommunicationWriter.clear">clear</a></li>
    <li class="mono"><a href="#concrete.util.redis_io.RedisCommunicationWriter.write">write</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></span>
        
          
  <ul>
    <li class="mono"><a href="#concrete.util.redis_io.RedisReader.__init__">__init__</a></li>
    <li class="mono"><a href="#concrete.util.redis_io.RedisReader.batch">batch</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#concrete.util.redis_io.RedisWriter">RedisWriter</a></span>
        
          
  <ul>
    <li class="mono"><a href="#concrete.util.redis_io.RedisWriter.__init__">__init__</a></li>
    <li class="mono"><a href="#concrete.util.redis_io.RedisWriter.clear">clear</a></li>
    <li class="mono"><a href="#concrete.util.redis_io.RedisWriter.write">write</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">concrete.util.redis_io</span> module</h1>
  
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io" class="source">
    <div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">concrete.util.mem_io</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">read_communication_from_buffer</span><span class="p">,</span>
    <span class="n">write_communication_to_buffer</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">uuid4</span>


<span class="k">def</span> <span class="nf">_identity</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">o</span>


<span class="k">def</span> <span class="nf">read_communication_from_redis_key</span><span class="p">(</span><span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">add_references</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Return a serialized communication from a string key.  If block</span>
<span class="sd">    is True, poll server until key appears at specified interval</span>
<span class="sd">    or until specified timeout (indefinitely if timeout is zero).</span>
<span class="sd">    Return None if block is False and key does not exist or if</span>
<span class="sd">    block is True and key does not exist after specified timeout.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">redis_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">buf</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">read_communication_from_buffer</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span>
                                              <span class="n">add_references</span><span class="o">=</span><span class="n">add_references</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RedisReader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Iterable class for reading one or more objects from redis.</span>

<span class="sd">    Supported input types are:</span>

<span class="sd">    - a set containing zero or more objects</span>
<span class="sd">    - a list containing zero or more objects</span>
<span class="sd">    - a hash containing zero or more key-object pairs</span>

<span class="sd">    For list and set types, the reader can optionally pop (consume) its</span>
<span class="sd">    input; for lists only, the reader can moreover block on the input.</span>

<span class="sd">    Note that iteration over a set or hash will create a temporary key</span>
<span class="sd">    in the redis database to maintain a set of elements scanned so far.</span>

<span class="sd">    If pop is False and the key (in the database) is modified during</span>
<span class="sd">    iteration, behavior is undefined.  If pop is True, modifications</span>
<span class="sd">    during iteration are encouraged. :)</span>

<span class="sd">    Example usage:</span>

<span class="sd">        from redis import Redis</span>
<span class="sd">        redis_db = Redis(port=12345)</span>
<span class="sd">        for obj in RedisReader(redis_db, &#39;my-set-key&#39;):</span>
<span class="sd">            do_something(obj)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pop</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">right_to_left</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">block_timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">temp_key_ttl</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span> <span class="n">temp_key_leaf_len</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                 <span class="n">cycle_list</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">deserialize_func</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create reader for specified key in specified</span>
<span class="sd">        redis_db.</span>

<span class="sd">            redis_db: object of class redis.Redis</span>
<span class="sd">            key:      name of redis key containing your object(s)</span>
<span class="sd">            key_type: &#39;set&#39;, &#39;list&#39;, &#39;hash&#39;, or None; if None, look up</span>
<span class="sd">                      type in redis (only works if the key exists, so</span>
<span class="sd">                      probably not suitable for block and/or pop modes)</span>
<span class="sd">            pop:      boolean, True to remove objects from redis</span>
<span class="sd">                      as we iterate over them, and False to leave redis</span>
<span class="sd">                      unaltered</span>
<span class="sd">            block:    boolean, True to block for data (i.e., wait for</span>
<span class="sd">                      something to be added to the list if it is empty),</span>
<span class="sd">                      False to end iteration when there is no more data</span>
<span class="sd">            right_to_left: boolean, True to iterate over and index in</span>
<span class="sd">                      lists from right to left, False to iterate/index</span>
<span class="sd">                      from left to right</span>
<span class="sd">            deserialize_func: function, maps blobs from redis to some more</span>
<span class="sd">                      friendly representation (e.g., if all your items</span>
<span class="sd">                      are unicode strings, you might want to specify</span>
<span class="sd">                      lambda s: s.decode(&#39;utf-8&#39;)); return blobs</span>
<span class="sd">                      unchanged if deserialize_func is None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span> <span class="o">=</span> <span class="n">redis_db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>

        <span class="k">if</span> <span class="n">key_type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># try to guess type</span>
            <span class="k">if</span> <span class="n">redis_db</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="n">key_type</span> <span class="o">=</span> <span class="n">redis_db</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only guess type of key that exists&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;hash&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;unrecognized key type </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">key_type</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">=</span> <span class="n">key_type</span>

        <span class="k">if</span> <span class="n">pop</span> <span class="ow">and</span> <span class="n">key_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only pop on set or list&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">block</span> <span class="ow">and</span> <span class="n">key_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only block-pop on list&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">block</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pop</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only block if popping too&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cycle_list</span> <span class="ow">and</span> <span class="n">block</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only cycle list when not blocking&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cycle_list</span> <span class="ow">and</span> <span class="n">key_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only cycle list on list type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cycle_list</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">right_to_left</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only cycle list if processing right-to-left&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span> <span class="o">=</span> <span class="n">pop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_timeout</span> <span class="o">=</span> <span class="n">block_timeout</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">temp_key_ttl</span> <span class="o">=</span> <span class="n">temp_key_ttl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_key_leaf_len</span> <span class="o">=</span> <span class="n">temp_key_leaf_len</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span> <span class="o">=</span> <span class="n">right_to_left</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cycle_list</span> <span class="o">=</span> <span class="n">cycle_list</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">deserialize_func</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">deserialize_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">_identity</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;set&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">:</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pop_buf</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">buf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
                <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pop_buf</span><span class="p">()</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle_list</span><span class="p">:</span>
                <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">rpoplpush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">buf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">llen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
                    <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">rpoplpush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">llen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)):</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span> <span class="k">else</span> <span class="n">i</span>
                    <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">lindex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;hash&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span><span class="p">:</span>
                <span class="n">num_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">scard</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
                <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">sscan</span>
                <span class="c1"># batch is an iterable of buffers</span>

                <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">num_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">hlen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
                <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">hscan</span>
                <span class="c1"># batch is a dict of key-buffer pairs</span>

                <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

            <span class="n">get_obj</span> <span class="o">=</span> <span class="n">_deserialize</span>

            <span class="n">temp_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_temp_key</span><span class="p">()</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_objs</span><span class="p">:</span>
                <span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span> <span class="o">=</span> <span class="n">scan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">cursor</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">num_objs</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">sadd</span><span class="p">(</span><span class="n">temp_key</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">yield</span> <span class="n">get_obj</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">expire</span><span class="p">(</span><span class="n">temp_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_key_ttl</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return instantaneous length of dataset.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">llen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">scard</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;hash&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">hlen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return item at specified list index or hash key;</span>
<span class="sd">        never pop or block.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;hash&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span> <span class="k">else</span> <span class="n">k</span>
                <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">lindex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">hget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">buf</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return a batch of n objects.  May be faster than</span>
<span class="sd">        one-at-a-time iteration, but currently only supported for</span>
<span class="sd">        non-popping, non-blocking set configurations.  Support for</span>
<span class="sd">        popping, non-blocking sets is planned; see</span>
<span class="sd">        http://redis.io/commands/spop .</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">buf</span>
                <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">srandmember</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pop_buf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Pop and return a serialized object, or None if there is</span>
<span class="sd">        none (or we blocked and timed out).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">:</span>
                <span class="n">_pop</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">brpop</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span>
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">blpop</span>
                <span class="p">)</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">_pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">block_timeout</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_pop</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">rpop</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span>
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">lpop</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">_pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">spop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_make_temp_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate temporary (random, unused) key.  Do not set in redis</span>
<span class="sd">        (leave that to the caller).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">temp_key</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">while</span> <span class="n">temp_key</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">temp_key</span><span class="p">):</span>
            <span class="c1"># thanks: http://stackoverflow.com/a/2257449</span>
            <span class="n">temp_key_leaf</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span>
            <span class="n">temp_key</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">temp_key_leaf</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">temp_key</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RedisCommunicationReader</span><span class="p">(</span><span class="n">RedisReader</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Iterable class for reading one or more Communications from redis.</span>
<span class="sd">    See RedisReader for further description.</span>

<span class="sd">    Example usage:</span>

<span class="sd">        from redis import Redis</span>
<span class="sd">        redis_db = Redis(port=12345)</span>
<span class="sd">        for comm in RedisCommunicationReader(redis_db, &#39;my-set-key&#39;):</span>
<span class="sd">            do_something(comm)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">add_references</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create communication reader for specified key in specified</span>
<span class="sd">        redis_db.</span>

<span class="sd">            redis_db: object of class redis.Redis</span>
<span class="sd">            key:      name of redis key containing your communication(s)</span>
<span class="sd">            add_references: boolean, True to fill in members in the</span>
<span class="sd">                      communication according to UUID relationships (see</span>
<span class="sd">                      concrete.util.add_references), False to return</span>
<span class="sd">                      communication as-is (note: you may need this False</span>
<span class="sd">                      if you are dealing with incomplete communications)</span>

<span class="sd">        All other keyword arguments are passed through to RedisReader.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;deserialize_func&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;RedisCommunicationReader does not allow custom &#39;</span>
                             <span class="s1">&#39;deserialize_func&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_references</span> <span class="o">=</span> <span class="n">add_references</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RedisCommunicationReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">deserialize_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_load_from_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_from_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buf</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">read_communication_from_buffer</span><span class="p">(</span>
            <span class="n">buf</span><span class="p">,</span> <span class="n">add_references</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add_references</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">write_communication_to_redis_key</span><span class="p">(</span><span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">comm</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Serialize communication and store result in redis key.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">redis_db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">write_communication_to_buffer</span><span class="p">(</span><span class="n">comm</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">RedisWriter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for writing one or more objects to redis.</span>

<span class="sd">    Supported input types are:</span>

<span class="sd">    - a set of objects</span>
<span class="sd">    - a list of objects</span>
<span class="sd">    - a hash of key-object pairs</span>

<span class="sd">    Example usage:</span>

<span class="sd">        from redis import Redis</span>
<span class="sd">        redis_db = Redis(port=12345)</span>
<span class="sd">        w = RedisWriter(redis_db, &#39;my-set-key&#39;)</span>
<span class="sd">        w.write(obj)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">right_to_left</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">serialize_func</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">hash_key_func</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create object writer for specified key in specified</span>
<span class="sd">        redis_db.</span>

<span class="sd">            redis_db: object of class redis.Redis</span>
<span class="sd">            key:      name of redis key containing your object(s)</span>
<span class="sd">            key_type: &#39;set&#39;, &#39;list&#39;, &#39;hash&#39;, or None; if None, look up</span>
<span class="sd">                      type in redis (only works if the key exists)</span>
<span class="sd">            right_to_left: boolean, True to write elements to the left</span>
<span class="sd">                      end of lists, False to write to the right end</span>
<span class="sd">            serialize_func: function, maps objects to blobs before</span>
<span class="sd">                      sending to Redis (e.g., if everything you write</span>
<span class="sd">                      will be a unicode string, you might want to use</span>
<span class="sd">                      lambda u: u.encode(&#39;utf-8&#39;)); pass objects to</span>
<span class="sd">                      Redis unchanged if serialize_func is None</span>
<span class="sd">            hash_key_func: function, maps objects to keys when key_type</span>
<span class="sd">                      is hash (None: use Python&#39;s hash function)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span> <span class="o">=</span> <span class="n">redis_db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>

        <span class="k">if</span> <span class="n">key_type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># try to guess type</span>
            <span class="k">if</span> <span class="n">redis_db</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="n">key_type</span> <span class="o">=</span> <span class="n">redis_db</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only guess type of key that exists&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;hash&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;unrecognized key type </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">key_type</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">=</span> <span class="n">key_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span> <span class="o">=</span> <span class="n">right_to_left</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">serialize_func</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">serialize_func</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">serialize_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">_identity</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hash_key_func</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">hash_key_func</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">hash_key_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">else</span> <span class="nb">hash</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_func</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
            <span class="n">_push</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">lpush</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span>
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">rpush</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">_push</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">sadd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;hash&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">hset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_key_func</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">buf</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RedisCommunicationWriter</span><span class="p">(</span><span class="n">RedisWriter</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for writing one or more Communications to redis.</span>
<span class="sd">    See RedisWriter for further description.</span>

<span class="sd">    Example usage:</span>

<span class="sd">        from redis import Redis</span>
<span class="sd">        redis_db = Redis(port=12345)</span>
<span class="sd">        w = RedisCommunicationWriter(redis_db, &#39;my-set-key&#39;)</span>
<span class="sd">        w.write(comm)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">uuid_hash_key</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create communication writer for specified key in specified</span>
<span class="sd">        redis_db.</span>

<span class="sd">            redis_db: object of class redis.Redis</span>
<span class="sd">            key:      name of redis key containing your communication(s)</span>
<span class="sd">            uuid_hash_key: boolean, True to use the UUID as the hash key</span>
<span class="sd">                      for a communication, False to use the id</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;serialize_func&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;RedisCommunicationWriter does not allow custom &#39;</span>
                             <span class="s1">&#39;serialize_func&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;hash_key_func&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;RedisCommunicationWriter does not allow custom &#39;</span>
                             <span class="s1">&#39;hash_key_func&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uuid_hash_key</span> <span class="o">=</span> <span class="n">uuid_hash_key</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RedisCommunicationWriter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">serialize_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_to_buffer</span><span class="p">,</span>
            <span class="n">hash_key_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_to_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comm</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">write_communication_to_buffer</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_to_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comm</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">comm</span><span class="o">.</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuidString</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uuid_hash_key</span> <span class="k">else</span> <span class="n">comm</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span><span class="p">)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="concrete.util.redis_io.read_communication_from_redis_key">
    <p>def <span class="ident">read_communication_from_redis_key</span>(</p><p>redis_db, key, add_references=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Return a serialized communication from a string key.  If block
is True, poll server until key appears at specified interval
or until specified timeout (indefinitely if timeout is zero).
Return None if block is False and key does not exist or if
block is True and key does not exist after specified timeout.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.read_communication_from_redis_key', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.read_communication_from_redis_key" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read_communication_from_redis_key</span><span class="p">(</span><span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">add_references</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Return a serialized communication from a string key.  If block</span>
<span class="sd">    is True, poll server until key appears at specified interval</span>
<span class="sd">    or until specified timeout (indefinitely if timeout is zero).</span>
<span class="sd">    Return None if block is False and key does not exist or if</span>
<span class="sd">    block is True and key does not exist after specified timeout.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">redis_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">buf</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">read_communication_from_buffer</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span>
                                              <span class="n">add_references</span><span class="o">=</span><span class="n">add_references</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="concrete.util.redis_io.write_communication_to_redis_key">
    <p>def <span class="ident">write_communication_to_redis_key</span>(</p><p>redis_db, key, comm)</p>
    </div>
    

    
  
    <div class="desc"><p>Serialize communication and store result in redis key.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.write_communication_to_redis_key', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.write_communication_to_redis_key" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write_communication_to_redis_key</span><span class="p">(</span><span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">comm</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Serialize communication and store result in redis key.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">redis_db</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">write_communication_to_buffer</span><span class="p">(</span><span class="n">comm</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="concrete.util.redis_io.RedisCommunicationReader" class="name">class <span class="ident">RedisCommunicationReader</span></p>
      
  
    <div class="desc"><p>Iterable class for reading one or more Communications from redis.
See RedisReader for further description.</p>
<p>Example usage:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">redis</span> <span class="kn">import</span> <span class="n">Redis</span>
<span class="n">redis_db</span> <span class="o">=</span> <span class="n">Redis</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>
<span class="k">for</span> <span class="n">comm</span> <span class="ow">in</span> <span class="n">RedisCommunicationReader</span><span class="p">(</span><span class="n">redis_db</span><span class="p">,</span> <span class="s1">&#39;my-set-key&#39;</span><span class="p">):</span>
    <span class="n">do_something</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.RedisCommunicationReader', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.RedisCommunicationReader" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">RedisCommunicationReader</span><span class="p">(</span><span class="n">RedisReader</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Iterable class for reading one or more Communications from redis.</span>
<span class="sd">    See RedisReader for further description.</span>

<span class="sd">    Example usage:</span>

<span class="sd">        from redis import Redis</span>
<span class="sd">        redis_db = Redis(port=12345)</span>
<span class="sd">        for comm in RedisCommunicationReader(redis_db, &#39;my-set-key&#39;):</span>
<span class="sd">            do_something(comm)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">add_references</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create communication reader for specified key in specified</span>
<span class="sd">        redis_db.</span>

<span class="sd">            redis_db: object of class redis.Redis</span>
<span class="sd">            key:      name of redis key containing your communication(s)</span>
<span class="sd">            add_references: boolean, True to fill in members in the</span>
<span class="sd">                      communication according to UUID relationships (see</span>
<span class="sd">                      concrete.util.add_references), False to return</span>
<span class="sd">                      communication as-is (note: you may need this False</span>
<span class="sd">                      if you are dealing with incomplete communications)</span>

<span class="sd">        All other keyword arguments are passed through to RedisReader.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;deserialize_func&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;RedisCommunicationReader does not allow custom &#39;</span>
                             <span class="s1">&#39;deserialize_func&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_references</span> <span class="o">=</span> <span class="n">add_references</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RedisCommunicationReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">deserialize_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_load_from_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_from_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buf</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">read_communication_from_buffer</span><span class="p">(</span>
            <span class="n">buf</span><span class="p">,</span> <span class="n">add_references</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add_references</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#concrete.util.redis_io.RedisCommunicationReader">RedisCommunicationReader</a></li>
          <li><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationReader.add_references" class="name">var <span class="ident">add_references</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationReader.block" class="name">var <span class="ident">block</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></code>.<code><a href="#concrete.util.redis_io.RedisReader.block">block</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationReader.block_timeout" class="name">var <span class="ident">block_timeout</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></code>.<code><a href="#concrete.util.redis_io.RedisReader.block_timeout">block_timeout</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationReader.cycle_list" class="name">var <span class="ident">cycle_list</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></code>.<code><a href="#concrete.util.redis_io.RedisReader.cycle_list">cycle_list</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationReader.deserialize_func" class="name">var <span class="ident">deserialize_func</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></code>.<code><a href="#concrete.util.redis_io.RedisReader.deserialize_func">deserialize_func</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationReader.key" class="name">var <span class="ident">key</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></code>.<code><a href="#concrete.util.redis_io.RedisReader.key">key</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationReader.key_type" class="name">var <span class="ident">key_type</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></code>.<code><a href="#concrete.util.redis_io.RedisReader.key_type">key_type</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationReader.pop" class="name">var <span class="ident">pop</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></code>.<code><a href="#concrete.util.redis_io.RedisReader.pop">pop</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationReader.redis_db" class="name">var <span class="ident">redis_db</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></code>.<code><a href="#concrete.util.redis_io.RedisReader.redis_db">redis_db</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationReader.right_to_left" class="name">var <span class="ident">right_to_left</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></code>.<code><a href="#concrete.util.redis_io.RedisReader.right_to_left">right_to_left</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationReader.temp_key_leaf_len" class="name">var <span class="ident">temp_key_leaf_len</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></code>.<code><a href="#concrete.util.redis_io.RedisReader.temp_key_leaf_len">temp_key_leaf_len</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationReader.temp_key_ttl" class="name">var <span class="ident">temp_key_ttl</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></code>.<code><a href="#concrete.util.redis_io.RedisReader.temp_key_ttl">temp_key_ttl</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="concrete.util.redis_io.RedisCommunicationReader.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, redis_db, key, add_references=True, **kwargs)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></code>.<code><a href="#concrete.util.redis_io.RedisReader.__init__">__init__</a></code>
    </p>

    
  
    <div class="desc"><p>Create communication reader for specified key in specified
redis_db.</p>
<div class="codehilite"><pre><span></span>redis_db: object of class redis.Redis
key:      name of redis key containing your communication(s)
add_references: boolean, True to fill in members in the
          communication according to UUID relationships (see
          concrete.util.add_references), False to return
          communication as-is (note: you may need this False
          if you are dealing with incomplete communications)
</pre></div>


<p>All other keyword arguments are passed through to RedisReader.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.RedisCommunicationReader.__init__', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.RedisCommunicationReader.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">add_references</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create communication reader for specified key in specified</span>
<span class="sd">    redis_db.</span>
<span class="sd">        redis_db: object of class redis.Redis</span>
<span class="sd">        key:      name of redis key containing your communication(s)</span>
<span class="sd">        add_references: boolean, True to fill in members in the</span>
<span class="sd">                  communication according to UUID relationships (see</span>
<span class="sd">                  concrete.util.add_references), False to return</span>
<span class="sd">                  communication as-is (note: you may need this False</span>
<span class="sd">                  if you are dealing with incomplete communications)</span>
<span class="sd">    All other keyword arguments are passed through to RedisReader.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;deserialize_func&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;RedisCommunicationReader does not allow custom &#39;</span>
                         <span class="s1">&#39;deserialize_func&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_references</span> <span class="o">=</span> <span class="n">add_references</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">RedisCommunicationReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
        <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">deserialize_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_load_from_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="concrete.util.redis_io.RedisCommunicationReader.batch">
    <p>def <span class="ident">batch</span>(</p><p>self, n)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></code>.<code><a href="#concrete.util.redis_io.RedisReader.batch">batch</a></code>
    </p>

    
  
    <div class="desc inherited"><p>Return a batch of n objects.  May be faster than
one-at-a-time iteration, but currently only supported for
non-popping, non-blocking set configurations.  Support for
popping, non-blocking sets is planned; see
http://redis.io/commands/spop .</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.RedisCommunicationReader.batch', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.RedisCommunicationReader.batch" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Return a batch of n objects.  May be faster than</span>
<span class="sd">    one-at-a-time iteration, but currently only supported for</span>
<span class="sd">    non-popping, non-blocking set configurations.  Support for</span>
<span class="sd">    popping, non-blocking sets is planned; see</span>
<span class="sd">    http://redis.io/commands/spop .</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">buf</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">srandmember</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="concrete.util.redis_io.RedisCommunicationWriter" class="name">class <span class="ident">RedisCommunicationWriter</span></p>
      
  
    <div class="desc"><p>Class for writing one or more Communications to redis.
See RedisWriter for further description.</p>
<p>Example usage:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">redis</span> <span class="kn">import</span> <span class="n">Redis</span>
<span class="n">redis_db</span> <span class="o">=</span> <span class="n">Redis</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">RedisCommunicationWriter</span><span class="p">(</span><span class="n">redis_db</span><span class="p">,</span> <span class="s1">&#39;my-set-key&#39;</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.RedisCommunicationWriter', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.RedisCommunicationWriter" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">RedisCommunicationWriter</span><span class="p">(</span><span class="n">RedisWriter</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for writing one or more Communications to redis.</span>
<span class="sd">    See RedisWriter for further description.</span>

<span class="sd">    Example usage:</span>

<span class="sd">        from redis import Redis</span>
<span class="sd">        redis_db = Redis(port=12345)</span>
<span class="sd">        w = RedisCommunicationWriter(redis_db, &#39;my-set-key&#39;)</span>
<span class="sd">        w.write(comm)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">uuid_hash_key</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create communication writer for specified key in specified</span>
<span class="sd">        redis_db.</span>

<span class="sd">            redis_db: object of class redis.Redis</span>
<span class="sd">            key:      name of redis key containing your communication(s)</span>
<span class="sd">            uuid_hash_key: boolean, True to use the UUID as the hash key</span>
<span class="sd">                      for a communication, False to use the id</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;serialize_func&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;RedisCommunicationWriter does not allow custom &#39;</span>
                             <span class="s1">&#39;serialize_func&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;hash_key_func&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;RedisCommunicationWriter does not allow custom &#39;</span>
                             <span class="s1">&#39;hash_key_func&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uuid_hash_key</span> <span class="o">=</span> <span class="n">uuid_hash_key</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RedisCommunicationWriter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">serialize_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_to_buffer</span><span class="p">,</span>
            <span class="n">hash_key_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_to_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comm</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">write_communication_to_buffer</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_to_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comm</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">comm</span><span class="o">.</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuidString</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uuid_hash_key</span> <span class="k">else</span> <span class="n">comm</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#concrete.util.redis_io.RedisCommunicationWriter">RedisCommunicationWriter</a></li>
          <li><a href="#concrete.util.redis_io.RedisWriter">RedisWriter</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationWriter.hash_key_func" class="name">var <span class="ident">hash_key_func</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisWriter">RedisWriter</a></code>.<code><a href="#concrete.util.redis_io.RedisWriter.hash_key_func">hash_key_func</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationWriter.key" class="name">var <span class="ident">key</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisWriter">RedisWriter</a></code>.<code><a href="#concrete.util.redis_io.RedisWriter.key">key</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationWriter.key_type" class="name">var <span class="ident">key_type</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisWriter">RedisWriter</a></code>.<code><a href="#concrete.util.redis_io.RedisWriter.key_type">key_type</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationWriter.redis_db" class="name">var <span class="ident">redis_db</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisWriter">RedisWriter</a></code>.<code><a href="#concrete.util.redis_io.RedisWriter.redis_db">redis_db</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationWriter.right_to_left" class="name">var <span class="ident">right_to_left</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisWriter">RedisWriter</a></code>.<code><a href="#concrete.util.redis_io.RedisWriter.right_to_left">right_to_left</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationWriter.serialize_func" class="name">var <span class="ident">serialize_func</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisWriter">RedisWriter</a></code>.<code><a href="#concrete.util.redis_io.RedisWriter.serialize_func">serialize_func</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisCommunicationWriter.uuid_hash_key" class="name">var <span class="ident">uuid_hash_key</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="concrete.util.redis_io.RedisCommunicationWriter.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, redis_db, key, uuid_hash_key=False, **kwargs)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisWriter">RedisWriter</a></code>.<code><a href="#concrete.util.redis_io.RedisWriter.__init__">__init__</a></code>
    </p>

    
  
    <div class="desc"><p>Create communication writer for specified key in specified
redis_db.</p>
<div class="codehilite"><pre><span></span>redis_db: object of class redis.Redis
key:      name of redis key containing your communication(s)
uuid_hash_key: boolean, True to use the UUID as the hash key
          for a communication, False to use the id
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.RedisCommunicationWriter.__init__', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.RedisCommunicationWriter.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">uuid_hash_key</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create communication writer for specified key in specified</span>
<span class="sd">    redis_db.</span>
<span class="sd">        redis_db: object of class redis.Redis</span>
<span class="sd">        key:      name of redis key containing your communication(s)</span>
<span class="sd">        uuid_hash_key: boolean, True to use the UUID as the hash key</span>
<span class="sd">                  for a communication, False to use the id</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;serialize_func&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;RedisCommunicationWriter does not allow custom &#39;</span>
                         <span class="s1">&#39;serialize_func&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;hash_key_func&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;RedisCommunicationWriter does not allow custom &#39;</span>
                         <span class="s1">&#39;hash_key_func&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uuid_hash_key</span> <span class="o">=</span> <span class="n">uuid_hash_key</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">RedisCommunicationWriter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
        <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">serialize_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_to_buffer</span><span class="p">,</span>
        <span class="n">hash_key_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="concrete.util.redis_io.RedisCommunicationWriter.clear">
    <p>def <span class="ident">clear</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisWriter">RedisWriter</a></code>.<code><a href="#concrete.util.redis_io.RedisWriter.clear">clear</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.RedisCommunicationWriter.clear', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.RedisCommunicationWriter.clear" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="concrete.util.redis_io.RedisCommunicationWriter.write">
    <p>def <span class="ident">write</span>(</p><p>self, obj)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#concrete.util.redis_io.RedisWriter">RedisWriter</a></code>.<code><a href="#concrete.util.redis_io.RedisWriter.write">write</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.RedisCommunicationWriter.write', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.RedisCommunicationWriter.write" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_func</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
        <span class="n">_push</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">lpush</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">rpush</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">_push</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">sadd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;hash&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">hset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_key_func</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">buf</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="concrete.util.redis_io.RedisReader" class="name">class <span class="ident">RedisReader</span></p>
      
  
    <div class="desc"><p>Iterable class for reading one or more objects from redis.</p>
<p>Supported input types are:</p>
<ul>
<li>a set containing zero or more objects</li>
<li>a list containing zero or more objects</li>
<li>a hash containing zero or more key-object pairs</li>
</ul>
<p>For list and set types, the reader can optionally pop (consume) its
input; for lists only, the reader can moreover block on the input.</p>
<p>Note that iteration over a set or hash will create a temporary key
in the redis database to maintain a set of elements scanned so far.</p>
<p>If pop is False and the key (in the database) is modified during
iteration, behavior is undefined.  If pop is True, modifications
during iteration are encouraged. :)</p>
<p>Example usage:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">redis</span> <span class="kn">import</span> <span class="n">Redis</span>
<span class="n">redis_db</span> <span class="o">=</span> <span class="n">Redis</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>
<span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">RedisReader</span><span class="p">(</span><span class="n">redis_db</span><span class="p">,</span> <span class="s1">&#39;my-set-key&#39;</span><span class="p">):</span>
    <span class="n">do_something</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.RedisReader', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.RedisReader" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">RedisReader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Iterable class for reading one or more objects from redis.</span>

<span class="sd">    Supported input types are:</span>

<span class="sd">    - a set containing zero or more objects</span>
<span class="sd">    - a list containing zero or more objects</span>
<span class="sd">    - a hash containing zero or more key-object pairs</span>

<span class="sd">    For list and set types, the reader can optionally pop (consume) its</span>
<span class="sd">    input; for lists only, the reader can moreover block on the input.</span>

<span class="sd">    Note that iteration over a set or hash will create a temporary key</span>
<span class="sd">    in the redis database to maintain a set of elements scanned so far.</span>

<span class="sd">    If pop is False and the key (in the database) is modified during</span>
<span class="sd">    iteration, behavior is undefined.  If pop is True, modifications</span>
<span class="sd">    during iteration are encouraged. :)</span>

<span class="sd">    Example usage:</span>

<span class="sd">        from redis import Redis</span>
<span class="sd">        redis_db = Redis(port=12345)</span>
<span class="sd">        for obj in RedisReader(redis_db, &#39;my-set-key&#39;):</span>
<span class="sd">            do_something(obj)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pop</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">right_to_left</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">block_timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">temp_key_ttl</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span> <span class="n">temp_key_leaf_len</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                 <span class="n">cycle_list</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">deserialize_func</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create reader for specified key in specified</span>
<span class="sd">        redis_db.</span>

<span class="sd">            redis_db: object of class redis.Redis</span>
<span class="sd">            key:      name of redis key containing your object(s)</span>
<span class="sd">            key_type: &#39;set&#39;, &#39;list&#39;, &#39;hash&#39;, or None; if None, look up</span>
<span class="sd">                      type in redis (only works if the key exists, so</span>
<span class="sd">                      probably not suitable for block and/or pop modes)</span>
<span class="sd">            pop:      boolean, True to remove objects from redis</span>
<span class="sd">                      as we iterate over them, and False to leave redis</span>
<span class="sd">                      unaltered</span>
<span class="sd">            block:    boolean, True to block for data (i.e., wait for</span>
<span class="sd">                      something to be added to the list if it is empty),</span>
<span class="sd">                      False to end iteration when there is no more data</span>
<span class="sd">            right_to_left: boolean, True to iterate over and index in</span>
<span class="sd">                      lists from right to left, False to iterate/index</span>
<span class="sd">                      from left to right</span>
<span class="sd">            deserialize_func: function, maps blobs from redis to some more</span>
<span class="sd">                      friendly representation (e.g., if all your items</span>
<span class="sd">                      are unicode strings, you might want to specify</span>
<span class="sd">                      lambda s: s.decode(&#39;utf-8&#39;)); return blobs</span>
<span class="sd">                      unchanged if deserialize_func is None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span> <span class="o">=</span> <span class="n">redis_db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>

        <span class="k">if</span> <span class="n">key_type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># try to guess type</span>
            <span class="k">if</span> <span class="n">redis_db</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="n">key_type</span> <span class="o">=</span> <span class="n">redis_db</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only guess type of key that exists&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;hash&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;unrecognized key type </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">key_type</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">=</span> <span class="n">key_type</span>

        <span class="k">if</span> <span class="n">pop</span> <span class="ow">and</span> <span class="n">key_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only pop on set or list&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">block</span> <span class="ow">and</span> <span class="n">key_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only block-pop on list&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">block</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pop</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only block if popping too&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cycle_list</span> <span class="ow">and</span> <span class="n">block</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only cycle list when not blocking&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cycle_list</span> <span class="ow">and</span> <span class="n">key_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only cycle list on list type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cycle_list</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">right_to_left</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only cycle list if processing right-to-left&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span> <span class="o">=</span> <span class="n">pop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_timeout</span> <span class="o">=</span> <span class="n">block_timeout</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">temp_key_ttl</span> <span class="o">=</span> <span class="n">temp_key_ttl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_key_leaf_len</span> <span class="o">=</span> <span class="n">temp_key_leaf_len</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span> <span class="o">=</span> <span class="n">right_to_left</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cycle_list</span> <span class="o">=</span> <span class="n">cycle_list</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">deserialize_func</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">deserialize_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">_identity</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;set&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">:</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pop_buf</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">buf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
                <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pop_buf</span><span class="p">()</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle_list</span><span class="p">:</span>
                <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">rpoplpush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">buf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">llen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
                    <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">rpoplpush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">llen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)):</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span> <span class="k">else</span> <span class="n">i</span>
                    <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">lindex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;hash&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span><span class="p">:</span>
                <span class="n">num_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">scard</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
                <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">sscan</span>
                <span class="c1"># batch is an iterable of buffers</span>

                <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">num_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">hlen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
                <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">hscan</span>
                <span class="c1"># batch is a dict of key-buffer pairs</span>

                <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

            <span class="n">get_obj</span> <span class="o">=</span> <span class="n">_deserialize</span>

            <span class="n">temp_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_temp_key</span><span class="p">()</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_objs</span><span class="p">:</span>
                <span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span> <span class="o">=</span> <span class="n">scan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">cursor</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">num_objs</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">sadd</span><span class="p">(</span><span class="n">temp_key</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">yield</span> <span class="n">get_obj</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">expire</span><span class="p">(</span><span class="n">temp_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_key_ttl</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return instantaneous length of dataset.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">llen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">scard</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;hash&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">hlen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return item at specified list index or hash key;</span>
<span class="sd">        never pop or block.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;hash&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span> <span class="k">else</span> <span class="n">k</span>
                <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">lindex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">hget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">buf</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return a batch of n objects.  May be faster than</span>
<span class="sd">        one-at-a-time iteration, but currently only supported for</span>
<span class="sd">        non-popping, non-blocking set configurations.  Support for</span>
<span class="sd">        popping, non-blocking sets is planned; see</span>
<span class="sd">        http://redis.io/commands/spop .</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">buf</span>
                <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">srandmember</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pop_buf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Pop and return a serialized object, or None if there is</span>
<span class="sd">        none (or we blocked and timed out).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">:</span>
                <span class="n">_pop</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">brpop</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span>
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">blpop</span>
                <span class="p">)</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">_pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">block_timeout</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_pop</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">rpop</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span>
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">lpop</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">_pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">spop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_make_temp_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate temporary (random, unused) key.  Do not set in redis</span>
<span class="sd">        (leave that to the caller).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">temp_key</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">while</span> <span class="n">temp_key</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">temp_key</span><span class="p">):</span>
            <span class="c1"># thanks: http://stackoverflow.com/a/2257449</span>
            <span class="n">temp_key_leaf</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span>
            <span class="n">temp_key</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">temp_key_leaf</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">temp_key</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#concrete.util.redis_io.RedisReader">RedisReader</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="concrete.util.redis_io.RedisReader.block" class="name">var <span class="ident">block</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisReader.block_timeout" class="name">var <span class="ident">block_timeout</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisReader.cycle_list" class="name">var <span class="ident">cycle_list</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisReader.deserialize_func" class="name">var <span class="ident">deserialize_func</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisReader.key" class="name">var <span class="ident">key</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisReader.key_type" class="name">var <span class="ident">key_type</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisReader.pop" class="name">var <span class="ident">pop</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisReader.redis_db" class="name">var <span class="ident">redis_db</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisReader.right_to_left" class="name">var <span class="ident">right_to_left</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisReader.temp_key_leaf_len" class="name">var <span class="ident">temp_key_leaf_len</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisReader.temp_key_ttl" class="name">var <span class="ident">temp_key_ttl</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="concrete.util.redis_io.RedisReader.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, redis_db, key, key_type=None, pop=False, block=False, right_to_left=True, block_timeout=0, temp_key_ttl=3600, temp_key_leaf_len=32, cycle_list=False, deserialize_func=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Create reader for specified key in specified
redis_db.</p>
<div class="codehilite"><pre><span></span>redis_db: object of class redis.Redis
key:      name of redis key containing your object(s)
key_type: &#39;set&#39;, &#39;list&#39;, &#39;hash&#39;, or None; if None, look up
          type in redis (only works if the key exists, so
          probably not suitable for block and/or pop modes)
pop:      boolean, True to remove objects from redis
          as we iterate over them, and False to leave redis
          unaltered
block:    boolean, True to block for data (i.e., wait for
          something to be added to the list if it is empty),
          False to end iteration when there is no more data
right_to_left: boolean, True to iterate over and index in
          lists from right to left, False to iterate/index
          from left to right
deserialize_func: function, maps blobs from redis to some more
          friendly representation (e.g., if all your items
          are unicode strings, you might want to specify
          lambda s: s.decode(&#39;utf-8&#39;)); return blobs
          unchanged if deserialize_func is None
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.RedisReader.__init__', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.RedisReader.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pop</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">right_to_left</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">block_timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">temp_key_ttl</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span> <span class="n">temp_key_leaf_len</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
             <span class="n">cycle_list</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">deserialize_func</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create reader for specified key in specified</span>
<span class="sd">    redis_db.</span>
<span class="sd">        redis_db: object of class redis.Redis</span>
<span class="sd">        key:      name of redis key containing your object(s)</span>
<span class="sd">        key_type: &#39;set&#39;, &#39;list&#39;, &#39;hash&#39;, or None; if None, look up</span>
<span class="sd">                  type in redis (only works if the key exists, so</span>
<span class="sd">                  probably not suitable for block and/or pop modes)</span>
<span class="sd">        pop:      boolean, True to remove objects from redis</span>
<span class="sd">                  as we iterate over them, and False to leave redis</span>
<span class="sd">                  unaltered</span>
<span class="sd">        block:    boolean, True to block for data (i.e., wait for</span>
<span class="sd">                  something to be added to the list if it is empty),</span>
<span class="sd">                  False to end iteration when there is no more data</span>
<span class="sd">        right_to_left: boolean, True to iterate over and index in</span>
<span class="sd">                  lists from right to left, False to iterate/index</span>
<span class="sd">                  from left to right</span>
<span class="sd">        deserialize_func: function, maps blobs from redis to some more</span>
<span class="sd">                  friendly representation (e.g., if all your items</span>
<span class="sd">                  are unicode strings, you might want to specify</span>
<span class="sd">                  lambda s: s.decode(&#39;utf-8&#39;)); return blobs</span>
<span class="sd">                  unchanged if deserialize_func is None</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span> <span class="o">=</span> <span class="n">redis_db</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
    <span class="k">if</span> <span class="n">key_type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># try to guess type</span>
        <span class="k">if</span> <span class="n">redis_db</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="n">key_type</span> <span class="o">=</span> <span class="n">redis_db</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only guess type of key that exists&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">key_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;hash&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;unrecognized key type </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">key_type</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">=</span> <span class="n">key_type</span>
    <span class="k">if</span> <span class="n">pop</span> <span class="ow">and</span> <span class="n">key_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only pop on set or list&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">block</span> <span class="ow">and</span> <span class="n">key_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only block-pop on list&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">block</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pop</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only block if popping too&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cycle_list</span> <span class="ow">and</span> <span class="n">block</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only cycle list when not blocking&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cycle_list</span> <span class="ow">and</span> <span class="n">key_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only cycle list on list type&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cycle_list</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">right_to_left</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only cycle list if processing right-to-left&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pop</span> <span class="o">=</span> <span class="n">pop</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">block</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">block_timeout</span> <span class="o">=</span> <span class="n">block_timeout</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp_key_ttl</span> <span class="o">=</span> <span class="n">temp_key_ttl</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp_key_leaf_len</span> <span class="o">=</span> <span class="n">temp_key_leaf_len</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span> <span class="o">=</span> <span class="n">right_to_left</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cycle_list</span> <span class="o">=</span> <span class="n">cycle_list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">deserialize_func</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">deserialize_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span> <span class="n">_identity</span>
    <span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="concrete.util.redis_io.RedisReader.batch">
    <p>def <span class="ident">batch</span>(</p><p>self, n)</p>
    </div>
    

    
  
    <div class="desc"><p>Return a batch of n objects.  May be faster than
one-at-a-time iteration, but currently only supported for
non-popping, non-blocking set configurations.  Support for
popping, non-blocking sets is planned; see
http://redis.io/commands/spop .</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.RedisReader.batch', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.RedisReader.batch" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Return a batch of n objects.  May be faster than</span>
<span class="sd">    one-at-a-time iteration, but currently only supported for</span>
<span class="sd">    non-popping, non-blocking set configurations.  Support for</span>
<span class="sd">    popping, non-blocking sets is planned; see</span>
<span class="sd">    http://redis.io/commands/spop .</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">buf</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">srandmember</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="concrete.util.redis_io.RedisWriter" class="name">class <span class="ident">RedisWriter</span></p>
      
  
    <div class="desc"><p>Class for writing one or more objects to redis.</p>
<p>Supported input types are:</p>
<ul>
<li>a set of objects</li>
<li>a list of objects</li>
<li>a hash of key-object pairs</li>
</ul>
<p>Example usage:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">redis</span> <span class="kn">import</span> <span class="n">Redis</span>
<span class="n">redis_db</span> <span class="o">=</span> <span class="n">Redis</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">RedisWriter</span><span class="p">(</span><span class="n">redis_db</span><span class="p">,</span> <span class="s1">&#39;my-set-key&#39;</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.RedisWriter', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.RedisWriter" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">RedisWriter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for writing one or more objects to redis.</span>

<span class="sd">    Supported input types are:</span>

<span class="sd">    - a set of objects</span>
<span class="sd">    - a list of objects</span>
<span class="sd">    - a hash of key-object pairs</span>

<span class="sd">    Example usage:</span>

<span class="sd">        from redis import Redis</span>
<span class="sd">        redis_db = Redis(port=12345)</span>
<span class="sd">        w = RedisWriter(redis_db, &#39;my-set-key&#39;)</span>
<span class="sd">        w.write(obj)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">right_to_left</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">serialize_func</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">hash_key_func</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create object writer for specified key in specified</span>
<span class="sd">        redis_db.</span>

<span class="sd">            redis_db: object of class redis.Redis</span>
<span class="sd">            key:      name of redis key containing your object(s)</span>
<span class="sd">            key_type: &#39;set&#39;, &#39;list&#39;, &#39;hash&#39;, or None; if None, look up</span>
<span class="sd">                      type in redis (only works if the key exists)</span>
<span class="sd">            right_to_left: boolean, True to write elements to the left</span>
<span class="sd">                      end of lists, False to write to the right end</span>
<span class="sd">            serialize_func: function, maps objects to blobs before</span>
<span class="sd">                      sending to Redis (e.g., if everything you write</span>
<span class="sd">                      will be a unicode string, you might want to use</span>
<span class="sd">                      lambda u: u.encode(&#39;utf-8&#39;)); pass objects to</span>
<span class="sd">                      Redis unchanged if serialize_func is None</span>
<span class="sd">            hash_key_func: function, maps objects to keys when key_type</span>
<span class="sd">                      is hash (None: use Python&#39;s hash function)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span> <span class="o">=</span> <span class="n">redis_db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>

        <span class="k">if</span> <span class="n">key_type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># try to guess type</span>
            <span class="k">if</span> <span class="n">redis_db</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="n">key_type</span> <span class="o">=</span> <span class="n">redis_db</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only guess type of key that exists&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;hash&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;unrecognized key type </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">key_type</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">=</span> <span class="n">key_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span> <span class="o">=</span> <span class="n">right_to_left</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">serialize_func</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">serialize_func</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">serialize_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">_identity</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hash_key_func</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">hash_key_func</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">hash_key_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">else</span> <span class="nb">hash</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_func</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
            <span class="n">_push</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">lpush</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span>
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">rpush</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">_push</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">sadd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;hash&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">hset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_key_func</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">buf</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#concrete.util.redis_io.RedisWriter">RedisWriter</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="concrete.util.redis_io.RedisWriter.hash_key_func" class="name">var <span class="ident">hash_key_func</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisWriter.key" class="name">var <span class="ident">key</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisWriter.key_type" class="name">var <span class="ident">key_type</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisWriter.redis_db" class="name">var <span class="ident">redis_db</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisWriter.right_to_left" class="name">var <span class="ident">right_to_left</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="concrete.util.redis_io.RedisWriter.serialize_func" class="name">var <span class="ident">serialize_func</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="concrete.util.redis_io.RedisWriter.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, redis_db, key, key_type=None, right_to_left=True, serialize_func=None, hash_key_func=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Create object writer for specified key in specified
redis_db.</p>
<div class="codehilite"><pre><span></span>redis_db: object of class redis.Redis
key:      name of redis key containing your object(s)
key_type: &#39;set&#39;, &#39;list&#39;, &#39;hash&#39;, or None; if None, look up
          type in redis (only works if the key exists)
right_to_left: boolean, True to write elements to the left
          end of lists, False to write to the right end
serialize_func: function, maps objects to blobs before
          sending to Redis (e.g., if everything you write
          will be a unicode string, you might want to use
          lambda u: u.encode(&#39;utf-8&#39;)); pass objects to
          Redis unchanged if serialize_func is None
hash_key_func: function, maps objects to keys when key_type
          is hash (None: use Python&#39;s hash function)
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.RedisWriter.__init__', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.RedisWriter.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_db</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">right_to_left</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">serialize_func</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">hash_key_func</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create object writer for specified key in specified</span>
<span class="sd">    redis_db.</span>
<span class="sd">        redis_db: object of class redis.Redis</span>
<span class="sd">        key:      name of redis key containing your object(s)</span>
<span class="sd">        key_type: &#39;set&#39;, &#39;list&#39;, &#39;hash&#39;, or None; if None, look up</span>
<span class="sd">                  type in redis (only works if the key exists)</span>
<span class="sd">        right_to_left: boolean, True to write elements to the left</span>
<span class="sd">                  end of lists, False to write to the right end</span>
<span class="sd">        serialize_func: function, maps objects to blobs before</span>
<span class="sd">                  sending to Redis (e.g., if everything you write</span>
<span class="sd">                  will be a unicode string, you might want to use</span>
<span class="sd">                  lambda u: u.encode(&#39;utf-8&#39;)); pass objects to</span>
<span class="sd">                  Redis unchanged if serialize_func is None</span>
<span class="sd">        hash_key_func: function, maps objects to keys when key_type</span>
<span class="sd">                  is hash (None: use Python&#39;s hash function)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span> <span class="o">=</span> <span class="n">redis_db</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
    <span class="k">if</span> <span class="n">key_type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># try to guess type</span>
        <span class="k">if</span> <span class="n">redis_db</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="n">key_type</span> <span class="o">=</span> <span class="n">redis_db</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can only guess type of key that exists&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">key_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;hash&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;unrecognized key type </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">key_type</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">=</span> <span class="n">key_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span> <span class="o">=</span> <span class="n">right_to_left</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">serialize_func</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">serialize_func</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">serialize_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span> <span class="n">_identity</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hash_key_func</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">hash_key_func</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">hash_key_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span> <span class="nb">hash</span>
    <span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="concrete.util.redis_io.RedisWriter.clear">
    <p>def <span class="ident">clear</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.RedisWriter.clear', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.RedisWriter.clear" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="concrete.util.redis_io.RedisWriter.write">
    <p>def <span class="ident">write</span>(</p><p>self, obj)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-concrete.util.redis_io.RedisWriter.write', this);">Show source &equiv;</a></p>
  <div id="source-concrete.util.redis_io.RedisWriter.write" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_func</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
        <span class="n">_push</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">lpush</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_to_left</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">rpush</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">_push</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">sadd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;hash&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span><span class="o">.</span><span class="n">hset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_key_func</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">buf</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not implemented&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
